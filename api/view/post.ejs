<%- include('partials/header', { title: 'P√°gina do Post' }) %>

    <div class="AlinhaForum">
        <!-- Menu lateral -->
        <aside class="menuLateral">
            <h3>Comunidades Populares</h3>
            <hr />
            <ul>
                <% if (comunidades && comunidades.length> 0) { %>
                    <% comunidades.forEach(com=> { %>
                        <li>
                            <a class="nomeComunidade" href="/comunidade/<%= com.ID_COMUNIDADE_T14 %>">
                                <div class="avatar_comunidade"></div>
                                <%= com.NOME_COMUNIDADE_T14 %>
                            </a>
                            <small>(<%= com.total_membros || 0 %> membros)</small>
                        </li>
                        <% }) %>
                            <% } else { %>
                                <li>Nenhuma comunidade encontrada</li>
                                <% } %>
            </ul>

            <button class="btn-criar-comunidade" onclick="mostrarFormularioComunidade()">
                + Nova Comunidade
            </button>
        </aside>

        <!-- Conte√∫do principal -->
        <main class="conteudoPrincipal">
            <div class="barraPesquisa">
                <span class="search-icon"><img src="/imagens/procurar.png" alt="Buscar"></span>
                <input type="text" id="campoPesquisa" placeholder="Busque palavra-chave/ f√≥rum/ etc" />
                <button>Buscar</button>
            </div>

            <% if (error) { %>
                <div class="error-message">
                    <h2>
                        <%= error %>
                    </h2>
                    <a href="/Forum">Voltar ao f√≥rum</a>
                </div>


                <% } else if (post) { %>
                    <h2 class="tituloPost">
                        <%= post.titulo %>
                    </h2>


                    <div class="forum-info">
                        <div class="avatar"
                            style="background-image: url('<%= post.autor_foto ? `${post.autor_foto}?v=${Date.now()}` : '/img/default.png' %>');"
                            data-user-id="<%= post.autor_id %>">
                        </div>


                        <span>
                            <% if (post.forum) { %>
                                <%= post.forum %>
                                    <% } else { %>
                                        Geral
                                        <% } %>
                        </span>
                        <span class="autor">‚Ä¢ por <%= post.autor %></span>
                        <span class="data">‚Ä¢ <%= new Date(post.data).toLocaleDateString('pt-BR') %></span>
                    </div>

                    <div class="postCompleto">

                        <div class="conteudoPost">
                            <%- post.conteudo %>

                                <% if (post.arquivo) { %>
                                    <div class="arquivo-post">
                                        <a href="<%= post.arquivo %>" target="_blank">
                                            üìé Ver anexo
                                        </a>
                                    </div>
                                    <% } %>
                        </div>
                    </div>

                    <div class="acoesPost">

                        <button class="btn-avaliacao-positivo">
                            <img class="avaliarBtn" src="/imagens/gostar.png" alt="">
                            <span id="likes">
                                <%= post.likes || 0 %>
                            </span>
                        </button>


                        <button class="btn-avaliacao-negativo">
                            <img class="avaliarBtn" src="/imagens/nao-gosto.png" alt="">
                            <span id="dislikes">
                                <%= post.dislikes || 0 %>
                            </span>
                        </button>

                    </div>

                    <!-- Coment√°rios -->
                    <div class="secaoComentarios">

                        <div class="comentarioBox" onclick="expandirComentario()">
                            <div class="comentarioInputArea">
                                <textarea placeholder="Add a comment..." onfocus="expandirComentario()"
                                    onblur="verificarFechamento(this)">
                                </textarea>
                            </div>
                            <div class="comentarioExtras">
                                <button>üñºÔ∏è</button>
                                <button>GIF</button>
                                <button>Aa</button>
                            </div>
                            <div class="comentarioAcoesDireita">
                                <button class="cancelarBtn" onclick="cancelarComentario()">Cancel</button>
                                <button class="comentarBtn">Comment</button>
                            </div>
                        </div>
                    </div>
                    <% } else { %>
                        <div class="error-message">
                            <h2>Post n√£o dispon√≠vel</h2>
                            <a href="/Forum">Voltar ao f√≥rum</a>
                        </div>
                        <% } %>
        </main>

        <aside class="infoForum">
            <% if (post) { %>
                <h4>
                    <% if (post.forum) { %>
                        c/<%= post.forum %>
                            <% } else { %>
                                Geral
                                <% } %>
                </h4>
                <% if (post.comunidade_descricao) { %>
                    <p>
                        <%= post.comunidade_descricao %>
                    </p>
                    <% } %>
                        <hr />
                        <div class="autorPost">
                            <div class="avatar"
                                style="background-image: url('<%= post.autor_foto ? `${post.autor_foto}?v=${Date.now()}` : '/img/default.png' %>');">
                            </div>
                            <span>
                                <%= post.autor %>
                            </span>
                        </div>
                        <% } else { %>
                            <h4>Informa√ß√µes n√£o dispon√≠veis</h4>
                            <p>Este post n√£o existe ou foi removido</p>
                            <% } %>
        </aside>

        <script>
            function expandirComentario() {
                const box = document.querySelector('.comentarioBox');
                box.classList.add('ativo');
            }

            function cancelarComentario() {
                const box = document.querySelector('.comentarioBox');
                const textarea = box.querySelector('textarea');
                textarea.value = "";
                box.classList.remove('ativo');
            }

            function verificarFechamento(textarea) {
                // se o conte√∫do estiver vazio ap√≥s desfocar, esconde tudo
                setTimeout(() => {
                    if (textarea.value.trim() === "") {
                        cancelarComentario();
                    }
                }, 100);
            }

        </script>
    </div>